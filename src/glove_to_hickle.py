#! python
import billion
import sys

import argparse

import numpy as np
import hickle

parser = argparse.ArgumentParser(description='Converts vectors to hickle-loadable')
parser.add_argument('-i','--input', help='Input file name', required=True)
parser.add_argument(     '--size',  help='Vector Size', required=True) # 240
parser.add_argument('-o','--output', help='Output file name', required=True)

args = parser.parse_args()

inputfile = open(args.input)

# the 1.150256 -0.381545 0.633861 -0.354940 0.406215 -0.024509 0.646822 -0.168761 0.285255 -0.227654 0.263571 -0.334567 0.261409 -0.454900 0.668469 -0.153747 -0.529080 -0.112547 -0.682870 -0.203826 0.389317 -0.639489 0.424013 0.492736 -0.737900 0.317694 0.683228 0.562253 -0.438440 0.194354 -0.973296 0.314982 -0.804363 -0.129340 0.552391 -0.546266 0.429557 0.523430 0.850425 0.256889 -0.187590 0.076533 0.428783 -0.068216 0.053905 0.760945 -0.526949 0.012213 -0.228169 -0.739755 0.187885 0.202089 0.516744 0.980060 0.777561 0.464808 1.232643 -0.220809 0.293420 0.190462 0.679767 0.068954 0.473758 -0.067252 0.207780 -0.560016 0.133402 0.272948 -0.151096 0.266012 0.677935 0.642130 -0.117944 0.492602 -0.646714 0.256935 -0.046105 0.827825 0.476187 1.158905 -0.064336 0.048499 -0.155097 -0.069053 0.445945 -0.683803 -0.297513 0.740672 -0.365518 0.846200 -0.569329 0.553882 -0.588650 -0.172705 -0.358614 -0.400772 -0.153096 0.235453 -0.192646 0.328011 0.870495 0.274983 -0.611588 0.354596 -0.316731 0.112940 0.665054 -0.382977 -0.602195 -0.559971 -0.379085 0.134515 -0.357383 -0.374666 -0.458367 -0.573369 0.210849 -0.257692 0.459730 -0.083559 -0.462809 0.023321 0.715720 0.056507 -0.276958 0.410646 0.320237 0.350981 0.422603 -0.086605 -0.415672 -0.129114 0.675164 0.251954 0.313349 -0.620377 0.403814 0.095062 -0.324058 -0.014814 0.881788 -0.874680 0.236548 -0.173938 0.010906 0.411087 0.360070 -0.349323 0.393029 -0.859440 -0.395806 -0.909433 0.510307 0.317487 1.158990 -0.330757 0.006691 0.557127 0.851147 0.412986 -0.015989 -0.180995 0.476612 0.393261 -0.075894 -0.092179 -0.105860 0.618510 -0.316757 -0.412806 -0.365298 0.295118 0.444546 0.235817 -0.884946 0.142902 -0.986903 -0.822325 -0.222286 -0.214673 -0.113336 -0.676077 0.412373 -0.137251 -0.384742 -0.389151 -0.558534 -0.144679 -0.399637 -0.226832 -0.433919 -0.788355 0.212051 -1.916482 0.304759 -0.298499 0.306900 0.026984 -0.114906 -0.613309 0.189720 -0.031295 -0.498031 0.082231 -0.019866 0.749232 0.395008 0.759701 -0.183413 0.292167 -0.143576 0.068748 0.299732 -0.305456 -1.203777 -0.201205 -0.779749 0.838358 -0.070143 0.381806 -0.234630 -0.188361 0.032635 0.290200 0.049721 0.390108 -0.124427 -0.691716 0.244936 0.325363 0.523669 0.050749 0.677465 -0.066856 0.201591 -0.398085 0.375965 -0.251972 0.285016 -0.072972
vector_py=[]
for line in inputfile:
	i = line.index(' ')
	arr = np.fromstring(line[i+1:], dtype=np.float32, sep=' ', count=int(args.size))
	vector_py.append(arr)
	#break

#See : http://stackoverflow.com/questions/22392497/how-to-add-a-new-row-to-an-empty-numpy-array
vectors = np.asarray(vector_py, dtype=np.float32)

to_hickle = dict(
  vectors = vectors,
)
hickle.dump(to_hickle, args.output, mode='w', compression='gzip')

